<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì°¸ê°€ì - ë™ë¬¼ ì´ˆì„± ë¹™ê³ </title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- ê²Œì„ ì…ì¥ í™”ë©´ -->
    <div id="joinScreen" class="container">
        <div class="card">
            <div class="header-icon">
                <div class="icon-wrapper gradient-cyan">
                    <span style="font-size: 3rem;">ğŸ¨</span>
                </div>
            </div>
            <h2 class="subtitle">ê²Œì„ ì°¸ê°€</h2>
            <p style="text-align: center; color: #cbd5e1; font-size: 0.875rem; margin-bottom: 2rem;">
                ê²Œì„ ì½”ë“œë¥¼ ì…ë ¥í•˜ê³  íŒ€ì„ ì„ íƒí•˜ì„¸ìš”
            </p>

            <div class="input-group">
                <label class="input-label">
                    <span>ğŸ®</span>
                    <span>ê²Œì„ ì½”ë“œ (6ìë¦¬)</span>
                </label>
                <input 
                    type="text" 
                    id="gameCodeInput" 
                    class="input-field" 
                    placeholder="123456"
                    maxlength="6"
                    style="text-align: center; font-size: 1.5rem; font-family: monospace; letter-spacing: 0.5rem;"
                >
            </div>

            <div class="input-group">
                <label class="input-label">
                    <span>ğŸ‘¥</span>
                    <span>íŒ€ ì„ íƒ</span>
                </label>
                <select 
                    id="teamSelect" 
                    class="input-field"
                    style="cursor: pointer;"
                >
                    <option value="">íŒ€ì„ ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="íŒ€1">íŒ€1</option>
                    <option value="íŒ€2">íŒ€2</option>
                    <option value="íŒ€3">íŒ€3</option>
                    <option value="íŒ€4">íŒ€4</option>
                    <option value="íŒ€5">íŒ€5</option>
                    <option value="íŒ€6">íŒ€6</option>
                    <option value="íŒ€7">íŒ€7</option>
                    <option value="íŒ€8">íŒ€8</option>
                    <option value="íŒ€9">íŒ€9</option>
                    <option value="íŒ€10">íŒ€10</option>
                </select>
            </div>

            <button class="btn btn-secondary" onclick="joinGame()">
                <span>â–¶ï¸</span>
                <span>ê²Œì„ ì°¸ê°€í•˜ê¸°</span>
            </button>

            <button class="btn btn-ghost" onclick="location.href='index.html'">
                <span>ğŸ </span>
                <span>ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</span>
            </button>
        </div>
    </div>

    <!-- ëŒ€ê¸° í™”ë©´ -->
    <div id="waitingScreen" class="container" style="display: none;">
        <div class="card" style="text-align: center;">
            <div class="header-icon">
                <div class="icon-wrapper gradient-cyan" style="animation: pulse 2s infinite;">
                    <span style="font-size: 3rem;">â°</span>
                </div>
            </div>
            <h2 class="subtitle">ê²Œì„ ì‹œì‘ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...</h2>
            <p style="color: #cbd5e1; margin-bottom: 2rem;">
                ì§„í–‰ìê°€ ê²Œì„ì„ ì‹œì‘í•  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”
            </p>

            <div style="background: rgba(15, 23, 42, 0.5); border-radius: 0.75rem; padding: 1rem; border: 1px solid rgba(148, 163, 184, 0.2);">
                <div style="font-size: 0.875rem; color: #94a3b8; margin-bottom: 0.5rem;">íŒ€ ì´ë¦„</div>
                <div style="font-size: 1.5rem; font-weight: 700; color: #06b6d4;" id="displayTeamName"></div>
            </div>
        </div>
    </div>

    <!-- ê²Œì„ í™”ë©´ -->
    <div id="gameScreen" class="container" style="display: none;">
        <div class="dashboard">
            <!-- ìƒë‹¨ ë°” -->
            <div class="top-bar">
                <div class="top-bar-left">
                    <div class="round-badge" id="roundBadge">1</div>
                    <div class="top-bar-info">
                        <div class="round-text">ë¼ìš´ë“œ <span id="roundNumber">1</span></div>
                        <div class="team-name" id="teamNameDisplay"></div>
                    </div>
                </div>
                <div class="top-bar-right">
                    <div class="score-badge">
                        <div class="badge-label">ë‚´ ì ìˆ˜</div>
                        <div class="badge-value" id="myScore">0ì </div>
                    </div>
                    <div class="code-badge">
                        <div class="badge-label">ê²Œì„ì½”ë“œ</div>
                        <div class="code-value" id="displayGameCode"></div>
                    </div>
                </div>
            </div>

            <!-- ë¬¸ì œ ì¹´ë“œ -->
            <div class="card">
                <div class="problem-card">
                    <div class="problem-label">
                        <span>ğŸ®</span>
                        <span>ì´ë²ˆ ì´ˆì„±ì€</span>
                    </div>
                    <div class="choseong-display">
                        <div class="choseong-text" id="choseongDisplay">ã„±</div>
                    </div>
                    <div class="hint-box">
                        <div class="hint-text">
                            <span>ğŸ’¡</span>
                            <span>íŒíŠ¸: <span id="hintDisplay">1~4ê¸€ì</span></span>
                        </div>
                    </div>
                </div>

                <!-- íƒ€ì´ë¨¸ -->
                <div class="timer-box">
                    <div class="timer-header">
                        <span class="timer-label">ë‚¨ì€ ì‹œê°„</span>
                        <span class="timer-value" id="timerDisplay">200ì´ˆ</span>
                    </div>
                    <div class="timer-bar">
                        <div class="timer-fill" id="timerFill" style="width: 100%;"></div>
                    </div>
                </div>

                <!-- ë‹µë³€ ì…ë ¥ -->
                <div style="margin-bottom: 1rem;">
                    <label class="input-label">ì´ˆì„±ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ë™ë¬¼ì„ ì…ë ¥</label>
                    <input 
                        type="text" 
                        id="answerInput" 
                        class="input-field" 
                        placeholder="ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”"
                        style="font-size: 1.125rem;"
                    >
                </div>

                <button id="submitBtn" class="btn btn-primary" onclick="submitAnswer()">
                    <span>âœ…</span>
                    <span>ë‹µë³€ ì œì¶œ</span>
                </button>

                <div id="submittedMessage" style="display: none; background: rgba(16, 185, 129, 0.2); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 0.75rem; padding: 1rem; text-align: center; color: #10b981; font-weight: 600; margin-top: 1rem;">
                    âœ… ë‹µë³€ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤. ì •ë‹µ ë°œí‘œë¥¼ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.
                </div>
            </div>
        </div>
    </div>

    <!-- ê²°ê³¼ í™”ë©´ (ì •ë‹µ) -->
    <div id="correctScreen" class="container" style="display: none;">
        <div class="card" style="text-align: center;">
            <div class="result-icon">âœ…</div>
            <h2 class="result-title" style="color: #10b981;">ì œì¶œ ì™„ë£Œ!</h2>
            <p class="result-message">ì •ë‹µì„ ë§ì¶”ì…¨ìŠµë‹ˆë‹¤</p>

            <div class="answer-display">
                <div class="answer-label">ì œì¶œí•œ ë‹µë³€</div>
                <div class="answer-text" id="submittedAnswer"></div>
            </div>

            <div class="score-display">
                <div class="score-label">íšë“ ì ìˆ˜</div>
                <div class="score-value">+<span id="earnedPoints">0</span>ì </div>
            </div>

            <p style="font-size: 0.875rem; color: #94a3b8; margin-top: 1.5rem;">
                ì§„í–‰ìê°€ ë‹¤ìŒ ë¼ìš´ë“œë¥¼ ì‹œì‘í•  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”
            </p>
        </div>
    </div>

    <!-- ê²°ê³¼ í™”ë©´ (ì˜¤ë‹µ) -->
    <div id="wrongScreen" class="container" style="display: none;">
        <div class="card" style="text-align: center;">
            <div class="result-icon">âŒ</div>
            <h2 class="result-title" style="color: #ef4444;">ì•„ì‰½ìŠµë‹ˆë‹¤!</h2>
            <p class="result-message" id="wrongMessage">ì˜¤ë‹µì…ë‹ˆë‹¤. ë‹¤ìŒ ë¼ìš´ë“œì—ì„œ ë‹¤ì‹œ ë„ì „í•˜ì„¸ìš”!</p>
            <p style="font-size: 0.875rem; color: #94a3b8; margin-top: 1rem;">
                ë‹¤ìŒ ë¼ìš´ë“œì—ì„œ ë‹¤ì‹œ ë„ì „í•˜ì„¸ìš”
            </p>
        </div>
    </div>

    <!-- ê²Œì„ ì¢…ë£Œ í™”ë©´ -->
    <div id="finishedScreen" class="container" style="display: none;">
        <div class="card" style="text-align: center; max-width: 800px;">
            <div style="font-size: 5rem; margin-bottom: 1rem; animation: bounce 1s infinite;">ğŸ‰</div>
            <h2 style="font-size: 3rem; font-weight: 800; background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 0.5rem;">
                ê²Œì„ ì¢…ë£Œ!
            </h2>
            <p style="color: #cbd5e1; margin-bottom: 3rem; font-size: 1.125rem;">ìµœì¢… ìˆœìœ„ê°€ ë°œí‘œë˜ì—ˆìŠµë‹ˆë‹¤</p>

            <!-- ì‹œìƒëŒ€ -->
            <div id="podium" style="display: flex; align-items: flex-end; justify-content: center; gap: 1rem; margin-bottom: 3rem; min-height: 300px;">
                <!-- JavaScriptë¡œ ìƒì„± -->
            </div>

            <!-- ì „ì²´ ìˆœìœ„ -->
            <div style="background: rgba(15, 23, 42, 0.5); border-radius: 1.5rem; padding: 2rem; border: 1px solid rgba(148, 163, 184, 0.2); margin-bottom: 2rem;">
                <h3 style="font-size: 1.5rem; font-weight: 700; color: white; margin-bottom: 1.5rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                    <span>ğŸ†</span>
                    <span>ì „ì²´ ìˆœìœ„</span>
                </h3>
                <div id="fullRanking" style="display: flex; flex-direction: column; gap: 0.75rem;">
                    <!-- JavaScriptë¡œ ìƒì„± -->
                </div>
            </div>

            <button class="btn btn-primary" onclick="location.href='index.html'" style="width: 100%; max-width: 400px;">
                <span>ğŸ </span>
                <span>ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</span>
            </button>
        </div>
    </div>

    <!-- ì ìˆ˜ íšë“ ëª¨ë‹¬ -->
    <div id="scoreModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border-radius: 2rem; padding: 2rem; max-width: 500px; width: 90%; border: 1px solid rgba(148, 163, 184, 0.2);">
            <div style="text-align: center;">
                <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ‰</div>
                <h2 style="font-size: 2rem; font-weight: 700; color: white; margin-bottom: 1rem;">ì •ë‹µ ë°œí‘œ!</h2>
                
                <div style="background: rgba(15, 23, 42, 0.5); border-radius: 1rem; padding: 1.5rem; border: 1px solid rgba(148, 163, 184, 0.2); margin-bottom: 1.5rem;">
                    <div style="color: #94a3b8; font-size: 0.875rem; margin-bottom: 0.5rem;">ì œì¶œí•œ ë‹µë³€</div>
                    <div style="font-size: 1.5rem; font-weight: 700; color: #06b6d4; margin-bottom: 1rem;" id="modalSubmittedAnswer"></div>
                    
                    <div style="color: #94a3b8; font-size: 0.875rem; margin-bottom: 0.5rem;">íšë“ ì ìˆ˜</div>
                    <div style="font-size: 3rem; font-weight: 700; color: #10b981;">+<span id="modalEarnedPoints">0</span>ì </div>
                </div>

                <div style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.2) 0%, rgba(236, 72, 153, 0.2) 100%); border-radius: 1rem; padding: 1rem; border: 1px solid rgba(168, 85, 247, 0.3);">
                    <div style="color: #94a3b8; font-size: 0.875rem; margin-bottom: 0.5rem;">í˜„ì¬ ì´ì </div>
                    <div style="font-size: 2rem; font-weight: 700; color: #a855f7;"><span id="modalTotalScore">0</span>ì </div>
                </div>

                <button onclick="closeScoreModal()" class="btn btn-primary" style="width: 100%; margin-top: 1.5rem;">
                    <span>í™•ì¸</span>
                </button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <style>
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(251, 191, 36, 0.5); }
            50% { box-shadow: 0 0 40px rgba(251, 191, 36, 0.8); }
        }

        .podium-place {
            display: flex;
            flex-direction: column;
            align-items: center;
            animation: slideUp 0.6s ease-out;
        }

        .podium-1 { animation-delay: 0.3s; order: 2; }
        .podium-2 { animation-delay: 0.1s; order: 1; }
        .podium-3 { animation-delay: 0.2s; order: 3; }

        .medal {
            font-size: 4rem;
            margin-bottom: 1rem;
            animation: bounce 2s infinite;
        }

        .podium-block {
            width: 150px;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(15, 23, 42, 0.9) 100%);
            border-radius: 1rem 1rem 0 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1.5rem 1rem;
            border: 2px solid;
            position: relative;
        }

        .podium-1 .podium-block {
            height: 200px;
            border-color: #fbbf24;
            animation: glow 2s infinite;
        }

        .podium-2 .podium-block {
            height: 150px;
            border-color: #94a3b8;
        }

        .podium-3 .podium-block {
            height: 120px;
            border-color: #cd7f32;
        }

        .rank-badge {
            position: absolute;
            top: -1rem;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.25rem;
            border: 3px solid;
        }

        .rank-1 {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            border-color: #fbbf24;
            color: white;
        }

        .rank-2 {
            background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
            border-color: #94a3b8;
            color: white;
        }

        .rank-3 {
            background: linear-gradient(135deg, #cd7f32 0%, #b86930 100%);
            border-color: #cd7f32;
            color: white;
        }

        @media (max-width: 640px) {
            .podium-block {
                width: 100px;
                padding: 1rem 0.5rem;
            }

            .podium-1 .podium-block { height: 150px; }
            .podium-2 .podium-block { height: 110px; }
            .podium-3 .podium-block { height: 90px; }

            .medal { font-size: 3rem; }
        }
    </style>
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCCuAOnkEmfFEE57D3bgWLU7xR2f0i2psI",
            authDomain: "animal-bingo-90774.firebaseapp.com",
            databaseURL: "https://animal-bingo-90774-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "animal-bingo-90774",
            storageBucket: "animal-bingo-90774.firebasestorage.app",
            messagingSenderId: "547100283990",
            appId: "1:547100283990:web:d1206d278a9f46eaf2d7f7",
            measurementId: "G-E8WLHPJ24E"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let gameCode = '';
        let teamName = '';
        let playerId = '';
        let currentScore = 0;
        let hasSubmitted = false;

        // ê²Œì„ ì°¸ê°€
        function joinGame() {
            const codeInput = document.getElementById('gameCodeInput').value.trim();
            const teamSelect = document.getElementById('teamSelect').value;

            console.log('ê²Œì„ ì°¸ê°€ ì‹œë„:', codeInput, teamSelect);

            if (!codeInput || codeInput.length !== 6) {
                alert('6ìë¦¬ ê²Œì„ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!teamSelect) {
                alert('íŒ€ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            // ê²Œì„ ì¡´ì¬ í™•ì¸
            database.ref(`games/${codeInput}`).once('value')
                .then((snapshot) => {
                    console.log('ê²Œì„ ë°ì´í„°:', snapshot.val());
                    
                    if (!snapshot.exists()) {
                        alert('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²Œì„ ì½”ë“œì…ë‹ˆë‹¤.');
                        return;
                    }

                    const gameData = snapshot.val();
                    
                    // ì´ë¯¸ í•´ë‹¹ íŒ€ì´ ì°¸ê°€í–ˆëŠ”ì§€ í™•ì¸
                    if (gameData.players) {
                        const existingTeam = Object.values(gameData.players).find(p => p.name === teamSelect);
                        if (existingTeam) {
                            alert('ì´ë¯¸ ì°¸ê°€í•œ íŒ€ì…ë‹ˆë‹¤. ë‹¤ë¥¸ íŒ€ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                            return;
                        }
                    }

                    gameCode = codeInput;
                    teamName = teamSelect;
                    playerId = Date.now().toString();

                    // í”Œë ˆì´ì–´ ë“±ë¡
                    database.ref(`games/${gameCode}/players/${playerId}`).set({
                        name: teamName,
                        score: 0,
                        joinedAt: Date.now()
                    }).then(() => {
                        console.log('í”Œë ˆì´ì–´ ë“±ë¡ ì™„ë£Œ');
                        
                        // í™”ë©´ ì „í™˜
                        document.getElementById('joinScreen').style.display = 'none';
                        document.getElementById('waitingScreen').style.display = 'flex';
                        document.getElementById('displayTeamName').textContent = teamName;

                        // ê²Œì„ ìƒíƒœ ë¦¬ìŠ¤ë„ˆ
                        setupGameListeners();
                    }).catch((error) => {
                        console.error('í”Œë ˆì´ì–´ ë“±ë¡ ì˜¤ë¥˜:', error);
                        alert('ê²Œì„ ì°¸ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
                    });
                })
                .catch((error) => {
                    console.error('ê²Œì„ í™•ì¸ ì˜¤ë¥˜:', error);
                    alert('ê²Œì„ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                });
        }

        // ê²Œì„ ìƒíƒœ ë¦¬ìŠ¤ë„ˆ
        let currentGameStatus = '';
        let currentGameRevealed = false;
        
        function setupGameListeners() {
            database.ref(`games/${gameCode}`).on('value', (snapshot) => {
                const data = snapshot.val();
                if (!data) return;

                // ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆì„ ë•Œë§Œ ì²˜ë¦¬
                if (data.status === 'playing') {
                    // ì •ë‹µ ë°œí‘œ ì‹œ ëª¨ë‹¬ í‘œì‹œ
                    if (data.revealed && hasSubmitted && !currentGameRevealed) {
                        currentGameRevealed = true;
                        showScoreModal();
                    } else if (!data.revealed && currentGameRevealed) {
                        // ìƒˆ ë¼ìš´ë“œ ì‹œì‘
                        currentGameRevealed = false;
                        hasSubmitted = false;
                        showGameScreen(data);
                    } else if (!data.revealed && currentGameStatus !== 'playing') {
                        // ì²˜ìŒ ê²Œì„ ì‹œì‘
                        currentGameStatus = 'playing';
                        hasSubmitted = false;
                        showGameScreen(data);
                    }
                } else if (data.status === 'finished' && currentGameStatus !== 'finished') {
                    currentGameStatus = 'finished';
                    showFinishedScreen();
                }
            });

            // í”Œë ˆì´ì–´ ì ìˆ˜ ë¦¬ìŠ¤ë„ˆ
            database.ref(`games/${gameCode}/players/${playerId}`).on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    currentScore = data.score || 0;
                    document.getElementById('myScore').textContent = currentScore + 'ì ';
                    document.getElementById('finalScore').textContent = currentScore;
                }
            });

            // íƒ€ì´ë¨¸ ë¦¬ìŠ¤ë„ˆ (ê²Œì„ ì§„í–‰ ì¤‘ì—ë§Œ)
            database.ref(`games/${gameCode}/timer`).on('value', (snapshot) => {
                const timer = snapshot.val();
                if (timer !== null && currentGameStatus === 'playing') {
                    database.ref(`games/${gameCode}/timeLimit`).once('value', (limitSnapshot) => {
                        const timeLimit = limitSnapshot.val() || 200;
                        updateTimer(timer, timeLimit);
                    });
                }
            });
        }

        // ì ìˆ˜ ëª¨ë‹¬ í‘œì‹œ
        function showScoreModal() {
            database.ref(`games/${gameCode}/submissions`).once('value', (snapshot) => {
                const submissions = snapshot.val() || {};
                const mySubmission = Object.values(submissions).find(sub => sub.playerId === playerId);

                if (mySubmission) {
                    document.getElementById('modalSubmittedAnswer').textContent = mySubmission.answer;
                    document.getElementById('modalEarnedPoints').textContent = mySubmission.points;
                    document.getElementById('modalTotalScore').textContent = currentScore;
                    
                    // ì˜¤ë‹µì¸ ê²½ìš° ì ìˆ˜ ë¶€ë¶„ ìƒ‰ìƒ ë³€ê²½
                    if (mySubmission.points === 0) {
                        document.getElementById('modalEarnedPoints').parentElement.innerHTML = 
                            '<div style="font-size: 3rem; font-weight: 700; color: #ef4444;">0ì </div>';
                    } else {
                        document.getElementById('modalEarnedPoints').parentElement.innerHTML = 
                            '<div style="font-size: 3rem; font-weight: 700; color: #10b981;">+<span id="modalEarnedPoints">' + mySubmission.points + '</span>ì </div>';
                    }
                    
                    document.getElementById('scoreModal').style.display = 'flex';
                }
            });
        }

        // ì ìˆ˜ ëª¨ë‹¬ ë‹«ê¸°
        function closeScoreModal() {
            document.getElementById('scoreModal').style.display = 'none';
        }

        // ê²Œì„ í™”ë©´ í‘œì‹œ
        function showGameScreen(gameData) {
            // ì •ë‹µ ë°ì´í„° ë¡œë“œ
            database.ref(`answers/${gameData.selectedChoseong}`).once('value', (answersSnapshot) => {
                const answersData = answersSnapshot.val();

                document.getElementById('waitingScreen').style.display = 'none';
                document.getElementById('correctScreen').style.display = 'none';
                document.getElementById('wrongScreen').style.display = 'none';
                document.getElementById('finishedScreen').style.display = 'none';
                document.getElementById('gameScreen').style.display = 'flex';

                document.getElementById('roundBadge').textContent = gameData.currentRound;
                document.getElementById('roundNumber').textContent = gameData.currentRound;
                document.getElementById('teamNameDisplay').textContent = teamName;
                document.getElementById('displayGameCode').textContent = gameCode;
                document.getElementById('choseongDisplay').textContent = gameData.selectedChoseong;
                document.getElementById('hintDisplay').textContent = answersData?.hint || 'ì—†ìŒ';

                // ì…ë ¥ì°½ ë° ë²„íŠ¼ ì´ˆê¸°í™”
                document.getElementById('answerInput').disabled = false;
                document.getElementById('answerInput').value = '';
                document.getElementById('submitBtn').disabled = false;
                document.getElementById('submitBtn').style.opacity = '1';
                document.getElementById('submitBtn').style.cursor = 'pointer';
                document.getElementById('submittedMessage').style.display = 'none';

                // íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸
                updateTimer(gameData.timer, gameData.timeLimit);
            });
        }

        // íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸
        function updateTimer(current, total) {
            document.getElementById('timerDisplay').textContent = current + 'ì´ˆ';
            const percentage = (current / total) * 100;
            document.getElementById('timerFill').style.width = percentage + '%';
        }

        // ë‹µë³€ ì œì¶œ
        function submitAnswer() {
            if (hasSubmitted) {
                alert('ì´ë¯¸ ë‹µë³€ì„ ì œì¶œí–ˆìŠµë‹ˆë‹¤.');
                return;
            }

            const answer = document.getElementById('answerInput').value.trim();
            if (!answer) {
                alert('ë‹µë³€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ê²Œì„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            database.ref(`games/${gameCode}`).once('value', (gameSnapshot) => {
                const gameData = gameSnapshot.val();

                // ì •ë‹µ í™•ì¸
                database.ref(`answers/${gameData.selectedChoseong}`).once('value', (answersSnapshot) => {
                    const answersData = answersSnapshot.val();
                    const isCorrect = answersData?.answers?.includes(answer);

                    // ì •ë‹µì´ë“  ì˜¤ë‹µì´ë“  ì œì¶œ ê¸°ë¡ (ì˜¤ë‹µì€ 0ì )
                    const points = isCorrect ? answer.length * 100 : 0;

                    database.ref(`games/${gameCode}/submissions`).push({
                        playerId: playerId,
                        playerName: teamName,
                        answer: answer,
                        points: points,
                        isCorrect: isCorrect,
                        timestamp: Date.now()
                    });

                    // ì •ë‹µì´ë“  ì˜¤ë‹µì´ë“  ì œì¶œ í›„ ì…ë ¥ ë¹„í™œì„±í™”
                    document.getElementById('answerInput').disabled = true;
                    document.getElementById('answerInput').value = answer;
                    document.getElementById('submitBtn').disabled = true;
                    document.getElementById('submitBtn').style.opacity = '0.5';
                    document.getElementById('submitBtn').style.cursor = 'not-allowed';
                    document.getElementById('submittedMessage').style.display = 'block';

                    hasSubmitted = true;
                });
            });
        }

        // ê²Œì„ ì¢…ë£Œ í™”ë©´
        function showFinishedScreen() {
            document.getElementById('joinScreen').style.display = 'none';
            document.getElementById('waitingScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('correctScreen').style.display = 'none';
            document.getElementById('wrongScreen').style.display = 'none';
            document.getElementById('finishedScreen').style.display = 'flex';

            // ì „ì²´ í”Œë ˆì´ì–´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            database.ref(`games/${gameCode}/players`).once('value', (snapshot) => {
                const players = snapshot.val() || {};
                const playerArray = Object.entries(players).map(([id, data]) => ({
                    id,
                    ...data
                }));

                // ì ìˆ˜ìˆœìœ¼ë¡œ ì •ë ¬
                playerArray.sort((a, b) => b.score - a.score);

                // ì‹œìƒëŒ€ ë Œë”ë§ (1, 2, 3ë“±ë§Œ)
                renderPodium(playerArray.slice(0, 3));

                // ì „ì²´ ìˆœìœ„ ë Œë”ë§
                renderFullRanking(playerArray);
            });
        }

        // ì‹œìƒëŒ€ ë Œë”ë§
        function renderPodium(topThree) {
            const podium = document.getElementById('podium');
            podium.innerHTML = '';

            const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
            const positions = [2, 1, 3]; // 2ë“±, 1ë“±, 3ë“± ìˆœì„œë¡œ ë°°ì¹˜

            topThree.forEach((player, index) => {
                const place = document.createElement('div');
                place.className = `podium-place podium-${index + 1}`;
                
                const isMyTeam = player.name === teamName;
                
                place.innerHTML = `
                    <div class="medal">${medals[index]}</div>
                    <div class="podium-block">
                        <div class="rank-badge rank-${index + 1}">${index + 1}</div>
                        <div style="font-size: 1.125rem; font-weight: 700; color: white; margin-bottom: 0.5rem; ${isMyTeam ? 'color: #06b6d4;' : ''}">${player.name}</div>
                        <div style="font-size: 1.75rem; font-weight: 800; color: ${index === 0 ? '#fbbf24' : index === 1 ? '#94a3b8' : '#cd7f32'};">
                            ${player.score}ì 
                        </div>
                    </div>
                `;
                podium.appendChild(place);
            });
        }

        // ì „ì²´ ìˆœìœ„ ë Œë”ë§
        function renderFullRanking(players) {
            const fullRanking = document.getElementById('fullRanking');
            fullRanking.innerHTML = '';

            players.forEach((player, index) => {
                const isMyTeam = player.name === teamName;
                const rankColor = index === 0 ? '#fbbf24' : index === 1 ? '#94a3b8' : index === 2 ? '#cd7f32' : '#64748b';
                
                const rankItem = document.createElement('div');
                rankItem.style.cssText = `
                    background: ${isMyTeam ? 'rgba(6, 182, 212, 0.2)' : 'rgba(15, 23, 42, 0.5)'};
                    border-radius: 0.75rem;
                    padding: 1rem;
                    border: 1px solid ${isMyTeam ? 'rgba(6, 182, 212, 0.5)' : 'rgba(148, 163, 184, 0.2)'};
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                `;
                
                rankItem.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="width: 2.5rem; height: 2.5rem; border-radius: 50%; background: ${rankColor}; display: flex; align-items: center; justify-content: center; color: white; font-weight: 800; font-size: 1.125rem;">
                            ${index + 1}
                        </div>
                        <div style="font-size: 1.125rem; font-weight: 600; color: ${isMyTeam ? '#06b6d4' : 'white'};">
                            ${player.name} ${isMyTeam ? '(ë‚˜)' : ''}
                        </div>
                    </div>
                    <div style="font-size: 1.5rem; font-weight: 700; color: ${rankColor};">
                        ${player.score}ì 
                    </div>
                `;
                
                fullRanking.appendChild(rankItem);
            });
        }

        // Enter í‚¤ë¡œ ì…ë ¥
        document.getElementById('gameCodeInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('teamSelect').focus();
            }
        });

        document.getElementById('answerInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                submitAnswer();
            }
        });
    </script>
</body>
</html>
