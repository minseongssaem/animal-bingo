<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒì›ê°€ì… - ë™ë¬¼ ì´ˆì„± ë¹™ê³ </title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header-icon">
                <div class="icon-wrapper gradient-pink">
                    <span style="font-size: 3rem;">ğŸ“</span>
                </div>
            </div>
            <h2 class="subtitle">íšŒì›ê°€ì…</h2>
            <p style="text-align: center; color: #cbd5e1; font-size: 0.875rem; margin-bottom: 2rem;">
                ì§„í–‰ì ê³„ì •ì„ ì‹ ì²­í•˜ì„¸ìš”
            </p>

            <div class="input-group">
                <label class="input-label">
                    <span>ğŸ‘¤</span>
                    <span>ì•„ì´ë””</span>
                </label>
                <input 
                    type="text" 
                    id="username" 
                    class="input-field" 
                    placeholder="ì•„ì´ë”” (4~20ì)"
                >
            </div>

            <div class="input-group">
                <label class="input-label">
                    <span>ğŸ”’</span>
                    <span>ë¹„ë°€ë²ˆí˜¸</span>
                </label>
                <input 
                    type="password" 
                    id="password" 
                    class="input-field" 
                    placeholder="ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)"
                >
            </div>

            <div class="input-group">
                <label class="input-label">
                    <span>ğŸ”’</span>
                    <span>ë¹„ë°€ë²ˆí˜¸ í™•ì¸</span>
                </label>
                <input 
                    type="password" 
                    id="passwordConfirm" 
                    class="input-field" 
                    placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸"
                >
            </div>

            <div class="input-group">
                <label class="input-label">
                    <span>âœï¸</span>
                    <span>ì´ë¦„</span>
                </label>
                <input 
                    type="text" 
                    id="name" 
                    class="input-field" 
                    placeholder="ì´ë¦„"
                >
            </div>

            <button class="btn btn-primary" onclick="register()">
                <span>âœ…</span>
                <span>ê°€ì… ì‹ ì²­</span>
            </button>

            <button class="btn btn-secondary" onclick="location.href='login.html'">
                <span>ğŸ”“</span>
                <span>ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ</span>
            </button>

            <button class="btn btn-ghost" onclick="location.href='index.html'">
                <span>ğŸ </span>
                <span>ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</span>
            </button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCCuAOnkEmfFEE57D3bgWLU7xR2f0i2psI",
            authDomain: "animal-bingo-90774.firebaseapp.com",
            databaseURL: "https://animal-bingo-90774-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "animal-bingo-90774",
            storageBucket: "animal-bingo-90774.firebasestorage.app",
            messagingSenderId: "547100283990",
            appId: "1:547100283990:web:d1206d278a9f46eaf2d7f7",
            measurementId: "G-E8WLHPJ24E"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // íšŒì›ê°€ì…
        function register() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            const passwordConfirm = document.getElementById('passwordConfirm').value.trim();
            const name = document.getElementById('name').value.trim();

            // ìœ íš¨ì„± ê²€ì‚¬
            if (!username || !password || !passwordConfirm || !name) {
                alert('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (username.length < 4 || username.length > 20) {
                alert('ì•„ì´ë””ëŠ” 4~20ì ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }

            if (password.length < 6) {
                alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }

            if (password !== passwordConfirm) {
                alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }

            // ì•„ì´ë”” ì¤‘ë³µ í™•ì¸
            database.ref('users').orderByChild('username').equalTo(username).once('value', (snapshot) => {
                if (snapshot.exists()) {
                    alert('ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.');
                    return;
                }

                // íšŒì›ê°€ì… ì²˜ë¦¬
                const newUserRef = database.ref('users').push();
                newUserRef.set({
                    username: username,
                    password: password,
                    name: name,
                    status: 'pending',
                    createdAt: Date.now()
                }).then(() => {
                    alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\nê´€ë¦¬ìì˜ ìŠ¹ì¸ì„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.');
                    location.href = 'login.html';
                }).catch((error) => {
                    alert('íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                });
            });
        }

        // Enter í‚¤ ì´ë²¤íŠ¸
        document.getElementById('username').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') document.getElementById('password').focus();
        });

        document.getElementById('password').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') document.getElementById('passwordConfirm').focus();
        });

        document.getElementById('passwordConfirm').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') document.getElementById('name').focus();
        });

        document.getElementById('name').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') register();
        });
    </script>
</body>
</html>
