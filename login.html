<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡œê·¸ì¸ - ë™ë¬¼ ì´ˆì„± ë¹™ê³ </title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header-icon">
                <div class="icon-wrapper gradient-pink">
                    <span style="font-size: 3rem;">ğŸ¦Š</span>
                </div>
            </div>
            <h2 class="subtitle">ì§„í–‰ì ë¡œê·¸ì¸</h2>
            <p style="text-align: center; color: #cbd5e1; font-size: 0.875rem; margin-bottom: 2rem;">
                ìŠ¹ì¸ëœ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”
            </p>

            <div class="input-group">
                <label class="input-label">
                    <span>ğŸ‘¤</span>
                    <span>ì•„ì´ë””</span>
                </label>
                <input 
                    type="text" 
                    id="username" 
                    class="input-field" 
                    placeholder="ì•„ì´ë””"
                >
            </div>

            <div class="input-group">
                <label class="input-label">
                    <span>ğŸ”’</span>
                    <span>ë¹„ë°€ë²ˆí˜¸</span>
                </label>
                <input 
                    type="password" 
                    id="password" 
                    class="input-field" 
                    placeholder="ë¹„ë°€ë²ˆí˜¸"
                >
            </div>

            <button class="btn btn-primary" onclick="login()">
                <span>ğŸ”“</span>
                <span>ë¡œê·¸ì¸</span>
            </button>

            <button class="btn btn-secondary" onclick="location.href='register.html'">
                <span>ğŸ“</span>
                <span>íšŒì›ê°€ì…</span>
            </button>

            <button class="btn btn-ghost" onclick="location.href='index.html'">
                <span>ğŸ </span>
                <span>ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</span>
            </button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCCuAOnkEmfFEE57D3bgWLU7xR2f0i2psI",
            authDomain: "animal-bingo-90774.firebaseapp.com",
            databaseURL: "https://animal-bingo-90774-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "animal-bingo-90774",
            storageBucket: "animal-bingo-90774.firebasestorage.app",
            messagingSenderId: "547100283990",
            appId: "1:547100283990:web:d1206d278a9f46eaf2d7f7",
            measurementId: "G-E8WLHPJ24E"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // ë¡œê·¸ì¸
        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();

            if (!username || !password) {
                alert('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ì‚¬ìš©ì í™•ì¸
            database.ref('users').orderByChild('username').equalTo(username).once('value', (snapshot) => {
                const users = snapshot.val();

                if (!users) {
                    alert('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.');
                    return;
                }

                const userId = Object.keys(users)[0];
                const user = users[userId];

                if (user.password !== password) {
                    alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    return;
                }

                if (user.status !== 'approved') {
                    alert('ì•„ì§ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.\nê´€ë¦¬ìì˜ ìŠ¹ì¸ì„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.');
                    return;
                }

                // ë§Œë£Œì¼ ì²´í¬
                if (user.expiryDate && user.expiryDate !== 'unlimited') {
                    const expiryDate = new Date(user.expiryDate);
                    const now = new Date();
                    
                    if (expiryDate < now) {
                        alert('ê³„ì • ì‚¬ìš© ê¸°ê°„ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\nê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.');
                        return;
                    }

                    // ë§Œë£Œ ì„ë°• ì•Œë¦¼ (7ì¼ ì´ë‚´)
                    const daysLeft = Math.ceil((expiryDate - now) / (1000 * 60 * 60 * 24));
                    if (daysLeft <= 7) {
                        alert(`âš ï¸ ê³„ì • ì‚¬ìš© ê¸°ê°„ì´ ${daysLeft}ì¼ ë‚¨ì•˜ìŠµë‹ˆë‹¤.\në§Œë£Œì¼: ${expiryDate.toLocaleDateString('ko-KR')}`);
                    }
                }

                // ë¡œê·¸ì¸ ì„±ê³µ
                sessionStorage.setItem('userId', userId);
                sessionStorage.setItem('username', user.username);
                sessionStorage.setItem('name', user.name);
                sessionStorage.setItem('expiryDate', user.expiryDate || 'unlimited');
                location.href = 'host-menu.html';
            });
        }

        // Enter í‚¤ ì´ë²¤íŠ¸
        document.getElementById('username').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('password').focus();
            }
        });

        document.getElementById('password').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                login();
            }
        });
    </script>
</body>
</html>
