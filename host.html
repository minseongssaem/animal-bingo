<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§„í–‰ì ëŒ€ì‹œë³´ë“œ - ë™ë¬¼ ì´ˆì„± ë¹™ê³ </title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- ë°© ìƒì„± í™”ë©´ -->
    <div id="createRoomScreen" class="container">
        <div class="card">
            <div class="header-icon">
                <div class="icon-wrapper gradient-pink">
                    <span style="font-size: 3rem;">ğŸ¦Š</span>
                </div>
            </div>
            <h2 class="subtitle">ë°© ê°œì„¤</h2>
            <p style="text-align: center; color: #cbd5e1; font-size: 0.875rem; margin-bottom: 2rem;">
                ê²Œì„ ì„¤ì •ì„ ì„ íƒí•˜ê³  ë°©ì„ ê°œì„¤í•˜ì„¸ìš”
            </p>

            <div class="input-group">
                <label class="input-label">
                    <span>ğŸ‘¥</span>
                    <span>ì°¸ê°€ íŒ€ ìˆ˜</span>
                </label>
                <input 
                    type="number" 
                    id="teamCountInput" 
                    class="input-field" 
                    placeholder="ì°¸ê°€í•  íŒ€ ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                    min="1"
                    max="20"
                    value="4"
                    style="text-align: center; font-size: 1.5rem;"
                >
                <p style="font-size: 0.75rem; color: #94a3b8; margin-top: 0.5rem;">
                    ê¶Œì¥: 2~10íŒ€
                </p>
            </div>

            <button class="btn btn-primary" onclick="createRoom()">
                <span>ğŸš€</span>
                <span>ë°© ê°œì„¤í•˜ê¸°</span>
            </button>

            <button class="btn btn-ghost" onclick="location.href='index.html'">
                <span>ğŸ </span>
                <span>ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</span>
            </button>
        </div>
    </div>

    <!-- ëŒ€ì‹œë³´ë“œ -->
    <div id="dashboardScreen" class="container" style="display: none;">
        <div class="dashboard">
            <div class="dashboard-header">
                <div class="dashboard-title">
                    <span style="font-size: 2rem;">ğŸ¦Š</span>
                    <div>
                        <h2>ì§„í–‰ì ëŒ€ì‹œë³´ë“œ</h2>
                        <p>ê²Œì„ ì§„í–‰ ì¤‘ (<span id="maxTeams">0</span>íŒ€ ì°¸ê°€ ê°€ëŠ¥)</p>
                    </div>
                </div>
                <div class="dashboard-actions">
                    <div class="game-code-badge">
                        <span>ê²Œì„ì½”ë“œ: <span id="gameCode">------</span></span>
                    </div>
                    <button class="btn btn-ghost" onclick="endGameAndGoHome()" style="width: auto; padding: 0.5rem 1rem;">
                        ì¢…ë£Œ
                    </button>
                </div>
            </div>

            <div class="grid grid-2" style="align-items: start;">
                <!-- ì™¼ìª½ ì˜ì—­ -->
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <!-- ê²Œì„ ìƒíƒœ -->
                    <div class="section">
                        <div class="section-header">
                            <span>ğŸ®</span>
                            <span>ê²Œì„ ìƒíƒœ</span>
                        </div>
                        <div class="grid grid-3" style="margin-bottom: 1rem;">
                            <div class="stat-card">
                                <div class="stat-value" style="color: #06b6d4;" id="currentRound">0</div>
                                <div class="stat-label">í˜„ì¬ ë¼ìš´ë“œ</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" style="color: #3b82f6;" id="playerCount">0</div>
                                <div class="stat-label">ì°¸ê°€ì ìˆ˜</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" style="color: #a855f7;" id="submissionCount">0</div>
                                <div class="stat-label">ì œì¶œ íŒ€</div>
                            </div>
                        </div>

                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            <button id="startBtn" class="btn btn-primary" onclick="startRound()" style="flex: 1; display: none;">
                                <span>â–¶ï¸</span>
                                <span>ê²Œì„ ì‹œì‘</span>
                            </button>
                            <button id="revealBtn" class="btn" onclick="revealAnswers()" style="flex: 1; display: none; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                                <span>ğŸ¯</span>
                                <span>ì •ë‹µ ë°œí‘œ</span>
                            </button>
                            <button id="nextBtn" class="btn btn-secondary" onclick="nextRound()" style="flex: 1; display: none;">
                                <span>â­ï¸</span>
                                <span>ë‹¤ìŒ ë¼ìš´ë“œ</span>
                            </button>
                            <button class="btn" onclick="endGame()" style="flex: 1; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white;">
                                <span>âŒ</span>
                                <span>ê²Œì„ ì¢…ë£Œ</span>
                            </button>
                        </div>
                    </div>

                    <!-- ë¼ìš´ë“œ ê´€ë¦¬ -->
                    <div class="section">
                        <div class="section-header">
                            <span>ğŸ“</span>
                            <span>ë¼ìš´ë“œ ê´€ë¦¬</span>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label style="font-size: 0.875rem; color: #94a3b8; margin-bottom: 0.5rem; display: block;">ì´ˆì„± ì„ íƒ</label>
                            <div class="choseong-grid" id="choseongGrid">
                                <!-- JavaScriptë¡œ ìƒì„± -->
                            </div>
                        </div>

                        <div id="selectedInfo" style="display: none; background: rgba(15, 23, 42, 0.5); border-radius: 0.75rem; padding: 1rem; border: 1px solid rgba(148, 163, 184, 0.2); margin-bottom: 1rem;">
                            <div style="font-size: 0.875rem; color: #fbbf24; margin-bottom: 0.5rem;">
                                ì„ íƒëœ ì´ˆì„±: <span id="selectedChoseong"></span>
                            </div>
                            <div style="font-size: 0.875rem; color: #94a3b8;">
                                íŒíŠ¸: <span id="selectedHint"></span>
                            </div>
                        </div>

                        <div>
                            <label style="font-size: 0.875rem; color: #94a3b8; margin-bottom: 0.5rem; display: block;">ë‹µë³€ ì‹œê°„ ì„¤ì •</label>
                            <div class="slider-container">
                                <input type="range" id="timeLimitSlider" class="slider" min="30" max="300" step="10" value="200">
                                <span class="slider-value"><span id="timeLimitValue">200</span>ì´ˆ</span>
                            </div>
                        </div>
                    </div>

                    <!-- ì œì¶œ í˜„í™© -->
                    <div class="section" id="submissionSection" style="display: none;">
                        <div class="section-header">
                            <span>ğŸ“Š</span>
                            <span>ì‹¤ì‹œê°„ ì œì¶œ í˜„í™©</span>
                        </div>
                        <div id="submissionList" class="submission-list">
                            <div class="empty-state">
                                ì•„ì§ ì œì¶œëœ ë‹µë³€ì´ ì—†ìŠµë‹ˆë‹¤.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì˜¤ë¥¸ìª½ ì˜ì—­ -->
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <!-- íŒ€ í˜„í™© -->
                    <div class="section">
                        <div class="section-header">
                            <span>ğŸ‘¥</span>
                            <span>íŒ€ í˜„í™©</span>
                        </div>
                        <div id="playerList" class="player-list">
                            <div class="empty-state">
                                ì°¸ê°€ìë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...
                            </div>
                        </div>
                    </div>

                    <!-- ì‹¤ì‹œê°„ ì°¸ê°€ì -->
                    <div class="section">
                        <div class="section-header">
                            <span>ğŸ”´</span>
                            <span>ì‹¤ì‹œê°„ ì°¸ê°€ì</span>
                        </div>
                        <div id="onlineList" style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <div class="empty-state">
                                ì ‘ì† ì¤‘ì¸ ì°¸ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì •ë‹µ ë°œí‘œ ëª¨ë‹¬ -->
    <div id="answerModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border-radius: 2rem; padding: 2rem; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; border: 1px solid rgba(148, 163, 184, 0.2);">
            <div style="text-align: center; margin-bottom: 2rem;">
                <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ¯</div>
                <h2 style="font-size: 2rem; font-weight: 700; color: white; margin-bottom: 0.5rem;">ì •ë‹µ ë°œí‘œ</h2>
                <p style="color: #94a3b8; font-size: 0.875rem;">ì´ˆì„±: <span id="modalChoseong" style="color: #06b6d4; font-weight: 600;"></span></p>
            </div>

            <div id="modalAnswerList" style="display: flex; flex-direction: column; gap: 0.75rem; margin-bottom: 2rem;">
                <!-- JavaScriptë¡œ ìƒì„± -->
            </div>

            <button onclick="closeAnswerModal()" class="btn btn-primary" style="width: 100%;">
                <span>í™•ì¸</span>
            </button>
        </div>
    </div>

    <!-- ê²Œì„ ì¢…ë£Œ ëª¨ë‹¬ -->
    <div id="finishModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 1000; align-items: center; justify-content: center; overflow-y: auto; padding: 2rem;">
        <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border-radius: 2rem; padding: 3rem; max-width: 900px; width: 100%; border: 1px solid rgba(148, 163, 184, 0.2);">
            <div style="text-align: center; margin-bottom: 3rem;">
                <div style="font-size: 5rem; margin-bottom: 1rem; animation: bounce 1s infinite;">ğŸ‰</div>
                <h2 style="font-size: 3rem; font-weight: 800; background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 0.5rem;">
                    ê²Œì„ ì¢…ë£Œ!
                </h2>
                <p style="color: #cbd5e1; font-size: 1.125rem;">ìµœì¢… ìˆœìœ„ê°€ ë°œí‘œë˜ì—ˆìŠµë‹ˆë‹¤</p>
            </div>

            <!-- ì‹œìƒëŒ€ -->
            <div id="hostPodium" style="display: flex; align-items: flex-end; justify-content: center; gap: 1rem; margin-bottom: 3rem; min-height: 300px;">
                <!-- JavaScriptë¡œ ìƒì„± -->
            </div>

            <!-- ì „ì²´ ìˆœìœ„ -->
            <div style="background: rgba(15, 23, 42, 0.5); border-radius: 1.5rem; padding: 2rem; border: 1px solid rgba(148, 163, 184, 0.2); margin-bottom: 2rem;">
                <h3 style="font-size: 1.5rem; font-weight: 700; color: white; margin-bottom: 1.5rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                    <span>ğŸ†</span>
                    <span>ì „ì²´ ìˆœìœ„</span>
                </h3>
                <div id="hostFullRanking" style="display: flex; flex-direction: column; gap: 0.75rem;">
                    <!-- JavaScriptë¡œ ìƒì„± -->
                </div>
            </div>

            <div style="display: flex; gap: 1rem;">
                <button onclick="closeFinishModal()" class="btn btn-secondary" style="flex: 1;">
                    <span>ë‹«ê¸°</span>
                </button>
                <button onclick="goHomeFromFinish()" class="btn btn-primary" style="flex: 1;">
                    <span>ğŸ </span>
                    <span>ë©”ì¸ìœ¼ë¡œ</span>
                </button>
            </div>
        </div>
    </div>

    <style>
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(251, 191, 36, 0.5); }
            50% { box-shadow: 0 0 40px rgba(251, 191, 36, 0.8); }
        }

        .podium-place {
            display: flex;
            flex-direction: column;
            align-items: center;
            animation: slideUp 0.6s ease-out;
        }

        .podium-1 { animation-delay: 0.3s; order: 2; }
        .podium-2 { animation-delay: 0.1s; order: 1; }
        .podium-3 { animation-delay: 0.2s; order: 3; }

        .medal {
            font-size: 4rem;
            margin-bottom: 1rem;
            animation: bounce 2s infinite;
        }

        .podium-block {
            width: 150px;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(15, 23, 42, 0.9) 100%);
            border-radius: 1rem 1rem 0 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1.5rem 1rem;
            border: 2px solid;
            position: relative;
        }

        .podium-1 .podium-block {
            height: 200px;
            border-color: #fbbf24;
            animation: glow 2s infinite;
        }

        .podium-2 .podium-block {
            height: 150px;
            border-color: #94a3b8;
        }

        .podium-3 .podium-block {
            height: 120px;
            border-color: #cd7f32;
        }

        .rank-badge {
            position: absolute;
            top: -1rem;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.25rem;
            border: 3px solid;
        }

        .rank-1 {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            border-color: #fbbf24;
            color: white;
        }

        .rank-2 {
            background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
            border-color: #94a3b8;
            color: white;
        }

        .rank-3 {
            background: linear-gradient(135deg, #cd7f32 0%, #b86930 100%);
            border-color: #cd7f32;
            color: white;
        }

        @media (max-width: 640px) {
            .podium-block {
                width: 100px;
                padding: 1rem 0.5rem;
            }

            .podium-1 .podium-block { height: 150px; }
            .podium-2 .podium-block { height: 110px; }
            .podium-3 .podium-block { height: 90px; }

            .medal { font-size: 3rem; }
        }
    </style>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCCuAOnkEmfFEE57D3bgWLU7xR2f0i2psI",
            authDomain: "animal-bingo-90774.firebaseapp.com",
            databaseURL: "https://animal-bingo-90774-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "animal-bingo-90774",
            storageBucket: "animal-bingo-90774.firebasestorage.app",
            messagingSenderId: "547100283990",
            appId: "1:547100283990:web:d1206d278a9f46eaf2d7f7",
            measurementId: "G-E8WLHPJ24E"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const choseongList = ['ã„±', 'ã„´', 'ã„·', 'ã„¹', 'ã…', 'ã…‚', 'ã……', 'ã…‡', 'ã…ˆ', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'];
        let gameCode = '';
        let currentChoseong = '';
        let timeLimit = 200;
        let timerInterval = null;
        let answersData = {};
        let maxTeams = 0;

        // ë°© ìƒì„±
        function createRoom() {
            console.log('ë°© ê°œì„¤ ë²„íŠ¼ í´ë¦­ë¨');
            
            const teamCount = parseInt(document.getElementById('teamCountInput').value);
            console.log('ì…ë ¥ëœ íŒ€ ìˆ˜:', teamCount);
            
            if (!teamCount || teamCount < 1) {
                alert('ì°¸ê°€ íŒ€ ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (ìµœì†Œ 1íŒ€)');
                return;
            }

            if (teamCount > 20) {
                alert('ì°¸ê°€ íŒ€ ìˆ˜ëŠ” ìµœëŒ€ 20íŒ€ê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }

            maxTeams = teamCount;
            console.log('ê²Œì„ ì´ˆê¸°í™” ì‹œì‘...');
            
            try {
                initializeGame();
                console.log('ê²Œì„ ì´ˆê¸°í™” ì™„ë£Œ');

                // í™”ë©´ ì „í™˜
                document.getElementById('createRoomScreen').style.display = 'none';
                document.getElementById('dashboardScreen').style.display = 'block';
            } catch (error) {
                console.error('ê²Œì„ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                alert('ê²Œì„ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ê²Œì„ ì´ˆê¸°í™”
        function initializeGame() {
            gameCode = Math.floor(100000 + Math.random() * 900000).toString();
            document.getElementById('gameCode').textContent = gameCode;
            document.getElementById('maxTeams').textContent = maxTeams;

            database.ref(`games/${gameCode}`).set({
                status: 'waiting',
                currentRound: 0,
                selectedChoseong: '',
                timeLimit: 200,
                timer: 0,
                maxTeams: maxTeams,
                createdAt: Date.now()
            });

            // ê²Œì„ ìƒíƒœ ë¦¬ìŠ¤ë„ˆ
            setupGameListeners();
            
            // ì •ë‹µ ë°ì´í„° ë¡œë“œ
            loadAnswersData();

            // ì´ˆì„± ë²„íŠ¼ ìƒì„±
            createChoseongButtons();

            // ì‹œì‘ ë²„íŠ¼ í‘œì‹œ
            document.getElementById('startBtn').style.display = 'flex';
        }

        // ì •ë‹µ ë°ì´í„° ë¡œë“œ
        function loadAnswersData() {
            database.ref('answers').on('value', (snapshot) => {
                answersData = snapshot.val() || {};
                updateChoseongButtons();
            });
        }

        // ì´ˆì„± ë²„íŠ¼ ìƒì„±
        function createChoseongButtons() {
            const grid = document.getElementById('choseongGrid');
            grid.innerHTML = '';
            
            choseongList.forEach(ch => {
                const btn = document.createElement('button');
                btn.className = 'choseong-btn';
                btn.textContent = ch;
                btn.id = `choseong-${ch}`;
                btn.onclick = () => selectChoseong(ch);
                grid.appendChild(btn);
            });
        }

        // ì´ˆì„± ë²„íŠ¼ ì—…ë°ì´íŠ¸
        function updateChoseongButtons() {
            choseongList.forEach(ch => {
                const btn = document.getElementById(`choseong-${ch}`);
                if (btn) {
                    const hasData = answersData[ch] && answersData[ch].answers && answersData[ch].answers.length > 0;
                    btn.disabled = !hasData;
                }
            });
        }

        // ì´ˆì„± ì„ íƒ
        function selectChoseong(ch) {
            if (!answersData[ch] || !answersData[ch].answers || answersData[ch].answers.length === 0) {
                alert('í•´ë‹¹ ì´ˆì„±ì— ë“±ë¡ëœ ì •ë‹µì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            currentChoseong = ch;
            
            document.querySelectorAll('.choseong-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`choseong-${ch}`).classList.add('active');

            document.getElementById('selectedInfo').style.display = 'block';
            document.getElementById('selectedChoseong').textContent = ch;
            document.getElementById('selectedHint').textContent = answersData[ch].hint || 'ì—†ìŒ';
        }

        // ê²Œì„ ì‹œì‘
        function startRound() {
            if (!currentChoseong) {
                alert('ì´ˆì„±ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            database.ref(`games/${gameCode}`).update({
                status: 'playing',
                currentRound: 1,
                selectedChoseong: currentChoseong,
                timeLimit: timeLimit,
                timer: timeLimit,
                startTime: Date.now(),
                revealed: false
            });

            // ì œì¶œ ëª©ë¡ ì´ˆê¸°í™”
            database.ref(`games/${gameCode}/submissions`).set({});

            startTimer();

            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('revealBtn').style.display = 'flex';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('submissionSection').style.display = 'block';
        }

        // ì •ë‹µ ë°œí‘œ
        function revealAnswers() {
            if (!confirm('ì •ë‹µì„ ë°œí‘œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì ìˆ˜ê°€ í™•ì •ë©ë‹ˆë‹¤.')) {
                return;
            }

            // ì œì¶œëœ ë‹µë³€ë“¤ì˜ ì ìˆ˜ë¥¼ ì‹¤ì œ í”Œë ˆì´ì–´ ì ìˆ˜ì— ë°˜ì˜
            database.ref(`games/${gameCode}/submissions`).once('value', (snapshot) => {
                const submissions = snapshot.val() || {};
                
                Object.values(submissions).forEach(sub => {
                    database.ref(`games/${gameCode}/players/${sub.playerId}`).once('value', (playerSnapshot) => {
                        const playerData = playerSnapshot.val();
                        if (playerData) {
                            database.ref(`games/${gameCode}/players/${sub.playerId}`).update({
                                score: (playerData.score || 0) + sub.points
                            });
                        }
                    });
                });

                // ì •ë‹µ ë°œí‘œ ìƒíƒœë¡œ ë³€ê²½
                database.ref(`games/${gameCode}`).update({
                    revealed: true
                });

                // ì •ë‹µ ëª¨ë‹¬ í‘œì‹œ
                showAnswerModal();

                document.getElementById('revealBtn').style.display = 'none';
                document.getElementById('nextBtn').style.display = 'flex';
            });
        }

        // ì •ë‹µ ëª¨ë‹¬ í‘œì‹œ
        function showAnswerModal() {
            const modal = document.getElementById('answerModal');
            const modalChoseong = document.getElementById('modalChoseong');
            const modalAnswerList = document.getElementById('modalAnswerList');

            database.ref(`games/${gameCode}`).once('value', (snapshot) => {
                const gameData = snapshot.val();
                const choseong = gameData.selectedChoseong;

                modalChoseong.textContent = choseong;

                // ì •ë‹µ ë¦¬ìŠ¤íŠ¸ í‘œì‹œ
                const answers = answersData[choseong]?.answers || [];
                modalAnswerList.innerHTML = answers.map((answer, index) => {
                    const points = answer.length * 100;
                    return `
                        <div style="background: rgba(15, 23, 42, 0.5); border-radius: 0.75rem; padding: 1rem; border: 1px solid rgba(148, 163, 184, 0.2); display: flex; align-items: center; justify-content: space-between;">
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <div style="width: 2rem; height: 2rem; border-radius: 50%; background: rgba(6, 182, 212, 0.2); display: flex; align-items: center; justify-content: center; color: #06b6d4; font-weight: 700; font-size: 0.875rem;">
                                    ${index + 1}
                                </div>
                                <span style="font-size: 1.125rem; font-weight: 600; color: white;">${answer}</span>
                            </div>
                            <span style="color: #10b981; font-weight: 600;">${points}ì </span>
                        </div>
                    `;
                }).join('');

                modal.style.display = 'flex';
            });
        }

        // ì •ë‹µ ëª¨ë‹¬ ë‹«ê¸°
        function closeAnswerModal() {
            document.getElementById('answerModal').style.display = 'none';
        }

        // ë‹¤ìŒ ë¼ìš´ë“œ
        function nextRound() {
            if (!currentChoseong) {
                alert('ì´ˆì„±ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            database.ref(`games/${gameCode}`).once('value', (snapshot) => {
                const data = snapshot.val();
                const currentRound = data.currentRound || 0;

                database.ref(`games/${gameCode}`).update({
                    status: 'playing',
                    currentRound: currentRound + 1,
                    selectedChoseong: currentChoseong,
                    timeLimit: timeLimit,
                    timer: timeLimit,
                    startTime: Date.now(),
                    revealed: false
                });

                // ì œì¶œ ëª©ë¡ ì´ˆê¸°í™”
                database.ref(`games/${gameCode}/submissions`).set({});

                // ì´ˆì„± ì„ íƒ ì´ˆê¸°í™”
                currentChoseong = '';
                document.querySelectorAll('.choseong-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.getElementById('selectedInfo').style.display = 'none';

                document.getElementById('nextBtn').style.display = 'none';
                document.getElementById('revealBtn').style.display = 'flex';

                startTimer();
            });
        }

        // ê²Œì„ ì¢…ë£Œ
        function endGame() {
            if (!confirm('ê²Œì„ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            database.ref(`games/${gameCode}`).update({
                status: 'finished'
            });

            if (timerInterval) {
                clearInterval(timerInterval);
            }

            // ìµœì¢… ìˆœìœ„ ëª¨ë‹¬ í‘œì‹œ
            showFinishModal();
        }

        // ìµœì¢… ìˆœìœ„ ëª¨ë‹¬ í‘œì‹œ
        function showFinishModal() {
            database.ref(`games/${gameCode}/players`).once('value', (snapshot) => {
                const players = snapshot.val() || {};
                const playerArray = Object.entries(players).map(([id, data]) => ({
                    id,
                    ...data
                }));

                // ì ìˆ˜ìˆœìœ¼ë¡œ ì •ë ¬
                playerArray.sort((a, b) => b.score - a.score);

                // ì‹œìƒëŒ€ ë Œë”ë§ (1, 2, 3ë“±ë§Œ)
                renderHostPodium(playerArray.slice(0, 3));

                // ì „ì²´ ìˆœìœ„ ë Œë”ë§
                renderHostFullRanking(playerArray);

                document.getElementById('finishModal').style.display = 'flex';
            });
        }

        // ì‹œìƒëŒ€ ë Œë”ë§
        function renderHostPodium(topThree) {
            const podium = document.getElementById('hostPodium');
            podium.innerHTML = '';

            const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];

            topThree.forEach((player, index) => {
                const place = document.createElement('div');
                place.className = `podium-place podium-${index + 1}`;
                
                place.innerHTML = `
                    <div class="medal">${medals[index]}</div>
                    <div class="podium-block">
                        <div class="rank-badge rank-${index + 1}">${index + 1}</div>
                        <div style="font-size: 1.125rem; font-weight: 700; color: white; margin-bottom: 0.5rem;">${player.name}</div>
                        <div style="font-size: 1.75rem; font-weight: 800; color: ${index === 0 ? '#fbbf24' : index === 1 ? '#94a3b8' : '#cd7f32'};">
                            ${player.score}ì 
                        </div>
                    </div>
                `;
                podium.appendChild(place);
            });
        }

        // ì „ì²´ ìˆœìœ„ ë Œë”ë§
        function renderHostFullRanking(players) {
            const fullRanking = document.getElementById('hostFullRanking');
            fullRanking.innerHTML = '';

            players.forEach((player, index) => {
                const rankColor = index === 0 ? '#fbbf24' : index === 1 ? '#94a3b8' : index === 2 ? '#cd7f32' : '#64748b';
                
                const rankItem = document.createElement('div');
                rankItem.style.cssText = `
                    background: rgba(15, 23, 42, 0.5);
                    border-radius: 0.75rem;
                    padding: 1rem;
                    border: 1px solid rgba(148, 163, 184, 0.2);
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                `;
                
                rankItem.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="width: 2.5rem; height: 2.5rem; border-radius: 50%; background: ${rankColor}; display: flex; align-items: center; justify-content: center; color: white; font-weight: 800; font-size: 1.125rem;">
                            ${index + 1}
                        </div>
                        <div style="font-size: 1.125rem; font-weight: 600; color: white;">
                            ${player.name}
                        </div>
                    </div>
                    <div style="font-size: 1.5rem; font-weight: 700; color: ${rankColor};">
                        ${player.score}ì 
                    </div>
                `;
                
                fullRanking.appendChild(rankItem);
            });
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeFinishModal() {
            document.getElementById('finishModal').style.display = 'none';
        }

        // ë©”ì¸ìœ¼ë¡œ
        function goHomeFromFinish() {
            location.href = 'index.html';
        }

        // ê²Œì„ ì¢…ë£Œ í›„ í™ˆìœ¼ë¡œ
        function endGameAndGoHome() {
            if (confirm('ê²Œì„ì„ ì¢…ë£Œí•˜ê³  ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                database.ref(`games/${gameCode}`).update({
                    status: 'finished'
                });

                if (timerInterval) {
                    clearInterval(timerInterval);
                }

                location.href = 'index.html';
            }
        }

        // íƒ€ì´ë¨¸ ì‹œì‘
        function startTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }

            timerInterval = setInterval(() => {
                database.ref(`games/${gameCode}`).once('value', (snapshot) => {
                    const data = snapshot.val();

                    if (data && data.timer > 0) {
                        database.ref(`games/${gameCode}`).update({
                            timer: data.timer - 1
                        });
                    } else {
                        clearInterval(timerInterval);
                    }
                });
            }, 1000);
        }

        // ê²Œì„ ìƒíƒœ ë¦¬ìŠ¤ë„ˆ
        function setupGameListeners() {
            // ê²Œì„ ìƒíƒœ
            database.ref(`games/${gameCode}`).on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    document.getElementById('currentRound').textContent = data.currentRound || 0;
                }
            });

            // í”Œë ˆì´ì–´ ëª©ë¡
            database.ref(`games/${gameCode}/players`).on('value', (snapshot) => {
                const players = snapshot.val() || {};
                const playerArray = Object.entries(players).map(([id, data]) => ({
                    id,
                    ...data
                }));

                document.getElementById('playerCount').textContent = playerArray.length;

                const playerList = document.getElementById('playerList');
                const onlineList = document.getElementById('onlineList');

                if (playerArray.length === 0) {
                    playerList.innerHTML = '<div class="empty-state">ì°¸ê°€ìë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...</div>';
                    onlineList.innerHTML = '<div class="empty-state">ì ‘ì† ì¤‘ì¸ ì°¸ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                } else {
                    playerList.innerHTML = playerArray.map((player, index) => `
                        <div class="player-item">
                            <div class="player-info">
                                <div class="player-number">${index + 1}</div>
                                <span class="player-name">${player.name}</span>
                            </div>
                            <span class="player-score">${player.score || 0}ì </span>
                        </div>
                    `).join('');

                    onlineList.innerHTML = playerArray.map(player => `
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div class="status-dot"></div>
                            <span style="font-size: 0.875rem; color: #cbd5e1;">${player.name} ì ‘ì† ì¤‘</span>
                        </div>
                    `).join('');
                }
            });

            // ì œì¶œ ëª©ë¡
            database.ref(`games/${gameCode}/submissions`).on('value', (snapshot) => {
                const submissions = snapshot.val() || {};
                const submissionArray = Object.entries(submissions).map(([id, data]) => ({
                    id,
                    ...data
                }));

                document.getElementById('submissionCount').textContent = submissionArray.length;

                const submissionList = document.getElementById('submissionList');
                if (submissionArray.length === 0) {
                    submissionList.innerHTML = '<div class="empty-state">ì•„ì§ ì œì¶œëœ ë‹µë³€ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                } else {
                    submissionList.innerHTML = submissionArray.map((sub, index) => `
                        <div class="submission-item">
                            <div class="submission-info">
                                <div class="submission-rank">${index + 1}</div>
                                <div class="submission-details">
                                    <div class="submission-name">${sub.playerName}</div>
                                    <div class="submission-answer" style="color: #10b981;">âœ… ì œì¶œ ì™„ë£Œ</div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
            });
        }

        // ì‹œê°„ ì œí•œ ìŠ¬ë¼ì´ë”
        document.getElementById('timeLimitSlider').addEventListener('input', (e) => {
            timeLimit = parseInt(e.target.value);
            document.getElementById('timeLimitValue').textContent = timeLimit;
        });
    </script>
</body>
</html>
