<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì •ë‹µ ê´€ë¦¬ - ë™ë¬¼ ì´ˆì„± ë¹™ê³ </title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="dashboard">
            <div class="card">
                <div class="dashboard-header">
                    <div class="dashboard-title">
                        <span style="font-size: 2rem;">âš™ï¸</span>
                        <div>
                            <h2>ì •ë‹µ ê´€ë¦¬</h2>
                            <p>ì´ˆì„±ë³„ ì •ë‹µê³¼ íŒíŠ¸ë¥¼ ë“±ë¡í•˜ì„¸ìš”</p>
                        </div>
                    </div>
                    <div class="dashboard-actions">
                        <button class="btn btn-ghost" onclick="location.href='index.html'">
                            <span>âŒ</span>
                            <span>ë‹«ê¸°</span>
                        </button>
                    </div>
                </div>

                <div class="section" style="margin-bottom: 1.5rem;">
                    <div class="section-header">
                        <span>ğŸ“</span>
                        <span>ì´ˆì„± ì„ íƒ</span>
                    </div>
                    <div class="choseong-grid" id="choseongGrid">
                        <!-- JavaScriptë¡œ ìƒì„± -->
                    </div>
                </div>

                <div class="section" style="margin-bottom: 1.5rem;">
                    <div class="section-header">
                        <span>ğŸ’¡</span>
                        <span>íŒíŠ¸ ì„¤ì •</span>
                    </div>
                    <input 
                        type="text" 
                        id="hintInput" 
                        class="input-field" 
                        placeholder="ì˜ˆ: 1~4ê¸€ì"
                    >
                </div>

                <div class="section" style="margin-bottom: 1.5rem;">
                    <div class="section-header">
                        <span>â•</span>
                        <span>ì •ë‹µ ì¶”ê°€</span>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <input 
                            type="text" 
                            id="answerInput" 
                            class="input-field" 
                            placeholder="ë™ë¬¼ ì´ë¦„ ì…ë ¥"
                            style="flex: 1;"
                        >
                        <button class="btn btn-primary" onclick="addAnswer()" style="width: auto; padding: 0.875rem 1.5rem;">
                            <span>â•</span>
                            <span>ì¶”ê°€</span>
                        </button>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header">
                        <span>ğŸ“‹</span>
                        <span>ë“±ë¡ëœ ì •ë‹µ (<span id="answerCount">0</span>ê°œ)</span>
                    </div>
                    <div id="answerList" class="player-list">
                        <div class="empty-state">
                            <p>ë“±ë¡ëœ ì •ë‹µì´ ì—†ìŠµë‹ˆë‹¤.</p>
                            <p style="font-size: 0.875rem; margin-top: 0.5rem;">ìœ„ì—ì„œ ì •ë‹µì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.</p>
                        </div>
                    </div>
                </div>

                <div id="currentHintDisplay" class="info-badge" style="display: none;">
                    <div class="info-text">
                        <span>ğŸ’¡</span>
                        <span>í˜„ì¬ íŒíŠ¸: <span id="currentHintText"></span></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCCuAOnkEmfFEE57D3bgWLU7xR2f0i2psI",
            authDomain: "animal-bingo-90774.firebaseapp.com",
            databaseURL: "https://animal-bingo-90774-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "animal-bingo-90774",
            storageBucket: "animal-bingo-90774.firebasestorage.app",
            messagingSenderId: "547100283990",
            appId: "1:547100283990:web:d1206d278a9f46eaf2d7f7",
            measurementId: "G-E8WLHPJ24E"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const choseongList = ['ã„±', 'ã„´', 'ã„·', 'ã„¹', 'ã…', 'ã…‚', 'ã……', 'ã…‡', 'ã…ˆ', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'];
        let currentChoseong = 'ã„±';

        // ì´ˆì„± ê·¸ë¦¬ë“œ ìƒì„±
        const choseongGrid = document.getElementById('choseongGrid');
        choseongList.forEach(ch => {
            const btn = document.createElement('button');
            btn.className = 'choseong-btn';
            btn.textContent = ch;
            btn.onclick = () => selectChoseong(ch);
            if (ch === currentChoseong) {
                btn.classList.add('active');
            }
            choseongGrid.appendChild(btn);
        });

        // ì´ˆì„± ì„ íƒ
        function selectChoseong(ch) {
            currentChoseong = ch;
            
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.choseong-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === ch) {
                    btn.classList.add('active');
                }
            });

            // ì„ íƒëœ ì´ˆì„±ì˜ ë°ì´í„° ë¡œë“œ
            loadAnswers(ch);
        }

        // ì •ë‹µ ë°ì´í„° ë¡œë“œ
        function loadAnswers(ch) {
            database.ref(`answers/${ch}`).on('value', (snapshot) => {
                const data = snapshot.val();
                const answerList = document.getElementById('answerList');
                const answerCount = document.getElementById('answerCount');
                const hintInput = document.getElementById('hintInput');
                const currentHintDisplay = document.getElementById('currentHintDisplay');
                const currentHintText = document.getElementById('currentHintText');

                if (data && data.answers && data.answers.length > 0) {
                    answerCount.textContent = data.answers.length;
                    hintInput.value = data.hint || '';
                    
                    if (data.hint) {
                        currentHintDisplay.style.display = 'block';
                        currentHintText.textContent = data.hint;
                    } else {
                        currentHintDisplay.style.display = 'none';
                    }

                    answerList.innerHTML = data.answers.map((answer, index) => {
                        const charCount = answer.length;
                        const points = charCount * 100;
                        return `
                            <div class="answer-item">
                                <div class="answer-content">
                                    <div class="answer-number">${index + 1}</div>
                                    <div class="answer-text-wrapper">
                                        <span class="answer-word">${answer}</span>
                                        <span class="answer-info">(${charCount}ê¸€ì = ${points}ì )</span>
                                    </div>
                                </div>
                                <button class="delete-btn" onclick="deleteAnswer(${index})">
                                    ğŸ—‘ï¸
                                </button>
                            </div>
                        `;
                    }).join('');
                } else {
                    answerCount.textContent = '0';
                    hintInput.value = '';
                    currentHintDisplay.style.display = 'none';
                    answerList.innerHTML = `
                        <div class="empty-state">
                            <p>ë“±ë¡ëœ ì •ë‹µì´ ì—†ìŠµë‹ˆë‹¤.</p>
                            <p style="font-size: 0.875rem; margin-top: 0.5rem;">ìœ„ì—ì„œ ì •ë‹µì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.</p>
                        </div>
                    `;
                }
            });
        }

        // ì •ë‹µ ì¶”ê°€
        function addAnswer() {
            const answerInput = document.getElementById('answerInput');
            const hintInput = document.getElementById('hintInput');
            const answer = answerInput.value.trim();
            const hint = hintInput.value.trim();

            if (!answer) {
                alert('ì •ë‹µì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!hint) {
                alert('íŒíŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            database.ref(`answers/${currentChoseong}`).once('value', (snapshot) => {
                const data = snapshot.val() || { answers: [], hint: '' };

                // ì¤‘ë³µ ì²´í¬
                if (data.answers && data.answers.includes(answer)) {
                    alert('ì´ë¯¸ ë“±ë¡ëœ ì •ë‹µì…ë‹ˆë‹¤.');
                    return;
                }

                data.answers.push(answer);
                data.hint = hint;

                database.ref(`answers/${currentChoseong}`).set(data).then(() => {
                    answerInput.value = '';
                    alert('ì •ë‹µì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }).catch((error) => {
                    console.error('ì •ë‹µ ì¶”ê°€ ì˜¤ë¥˜:', error);
                    alert('ì •ë‹µ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                });
            });
        }

        // ì •ë‹µ ì‚­ì œ
        function deleteAnswer(index) {
            if (!confirm('ì´ ì •ë‹µì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            database.ref(`answers/${currentChoseong}`).once('value', (snapshot) => {
                const data = snapshot.val();

                if (data && data.answers) {
                    data.answers.splice(index, 1);
                    database.ref(`answers/${currentChoseong}`).set(data).then(() => {
                        alert('ì •ë‹µì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    }).catch((error) => {
                        console.error('ì •ë‹µ ì‚­ì œ ì˜¤ë¥˜:', error);
                        alert('ì •ë‹µ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    });
                }
            });
        }

        // Enter í‚¤ë¡œ ì •ë‹µ ì¶”ê°€
        document.getElementById('answerInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addAnswer();
            }
        });

        // ì´ˆê¸° ë¡œë“œ
        loadAnswers(currentChoseong);
    </script>
</body>
</html>
