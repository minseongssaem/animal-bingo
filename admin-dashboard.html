<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ - ë™ë¬¼ ì´ˆì„± ë¹™ê³ </title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="dashboard">
            <div class="card">
                <div class="dashboard-header">
                    <div class="dashboard-title">
                        <span style="font-size: 2rem;">ğŸ”</span>
                        <div>
                            <h2>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h2>
                            <p>íšŒì› ê°€ì… ìŠ¹ì¸ ê´€ë¦¬</p>
                        </div>
                    </div>
                    <div class="dashboard-actions">
                        <button class="btn btn-ghost" onclick="logout()">
                            <span>ğŸšª</span>
                            <span>ë¡œê·¸ì•„ì›ƒ</span>
                        </button>
                    </div>
                </div>

                <!-- ëŒ€ê¸° ì¤‘ì¸ íšŒì› -->
                <div class="section" style="margin-bottom: 1.5rem;">
                    <div class="section-header">
                        <span>â³</span>
                        <span>ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ (<span id="pendingCount">0</span>ëª…)</span>
                    </div>
                    <div id="pendingList" class="player-list">
                        <div class="empty-state">
                            <p>ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                    </div>
                </div>

                <!-- ìŠ¹ì¸ëœ íšŒì› -->
                <div class="section">
                    <div class="section-header">
                        <span>âœ…</span>
                        <span>ìŠ¹ì¸ëœ íšŒì› (<span id="approvedCount">0</span>ëª…)</span>
                    </div>
                    <div id="approvedList" class="player-list">
                        <div class="empty-state">
                            <p>ìŠ¹ì¸ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCCuAOnkEmfFEE57D3bgWLU7xR2f0i2psI",
            authDomain: "animal-bingo-90774.firebaseapp.com",
            databaseURL: "https://animal-bingo-90774-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "animal-bingo-90774",
            storageBucket: "animal-bingo-90774.firebasestorage.app",
            messagingSenderId: "547100283990",
            appId: "1:547100283990:web:d1206d278a9f46eaf2d7f7",
            measurementId: "G-E8WLHPJ24E"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // ë¡œê·¸ì¸ í™•ì¸
        if (sessionStorage.getItem('adminLoggedIn') !== 'true') {
            alert('ê´€ë¦¬ì ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            location.href = 'admin-login.html';
        }

        // íšŒì› ëª©ë¡ ë¡œë“œ
        function loadUsers() {
            database.ref('users').on('value', (snapshot) => {
                const users = snapshot.val() || {};
                const userArray = Object.entries(users).map(([id, data]) => ({
                    id,
                    ...data
                }));

                const pending = userArray.filter(u => u.status === 'pending');
                const approved = userArray.filter(u => u.status === 'approved');

                renderPendingUsers(pending);
                renderApprovedUsers(approved);
            });
        }

        // ëŒ€ê¸° ì¤‘ì¸ íšŒì› ë Œë”ë§
        function renderPendingUsers(users) {
            const pendingList = document.getElementById('pendingList');
            const pendingCount = document.getElementById('pendingCount');

            pendingCount.textContent = users.length;

            if (users.length === 0) {
                pendingList.innerHTML = '<div class="empty-state"><p>ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>';
            } else {
                pendingList.innerHTML = users.map(user => `
                    <div class="answer-item">
                        <div class="answer-content">
                            <div style="display: flex; flex-direction: column;">
                                <span class="answer-word">${user.name}</span>
                                <span class="answer-info">ì•„ì´ë””: ${user.username}</span>
                                <span class="answer-info" style="font-size: 0.75rem; color: #64748b;">ê°€ì…ì¼: ${new Date(user.createdAt).toLocaleString('ko-KR')}</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button onclick="approveUser('${user.id}')" style="padding: 0.5rem 1rem; background: #10b981; color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 600;">
                                âœ… ìŠ¹ì¸
                            </button>
                            <button onclick="rejectUser('${user.id}')" style="padding: 0.5rem 1rem; background: #ef4444; color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 600;">
                                âŒ ê±°ë¶€
                            </button>
                        </div>
                    </div>
                `).join('');
            }
        }

        // ìŠ¹ì¸ëœ íšŒì› ë Œë”ë§
        function renderApprovedUsers(users) {
            const approvedList = document.getElementById('approvedList');
            const approvedCount = document.getElementById('approvedCount');

            approvedCount.textContent = users.length;

            if (users.length === 0) {
                approvedList.innerHTML = '<div class="empty-state"><p>ìŠ¹ì¸ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>';
            } else {
                approvedList.innerHTML = users.map(user => `
                    <div class="answer-item">
                        <div class="answer-content">
                            <div style="display: flex; flex-direction: column;">
                                <span class="answer-word">${user.name}</span>
                                <span class="answer-info">ì•„ì´ë””: ${user.username}</span>
                                <span class="answer-info" style="font-size: 0.75rem; color: #64748b;">ìŠ¹ì¸ì¼: ${new Date(user.approvedAt || user.createdAt).toLocaleString('ko-KR')}</span>
                            </div>
                        </div>
                        <button onclick="revokeUser('${user.id}')" class="delete-btn" style="font-size: 0.875rem;">
                            ğŸš« ìŠ¹ì¸ ì·¨ì†Œ
                        </button>
                    </div>
                `).join('');
            }
        }

        // ìŠ¹ì¸
        window.approveUser = function(userId) {
            if (confirm('ì´ íšŒì›ì„ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                database.ref(`users/${userId}`).update({
                    status: 'approved',
                    approvedAt: Date.now()
                });
            }
        };

        // ê±°ë¶€
        window.rejectUser = function(userId) {
            if (confirm('ì´ íšŒì›ì„ ê±°ë¶€í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤)')) {
                database.ref(`users/${userId}`).remove();
            }
        };

        // ìŠ¹ì¸ ì·¨ì†Œ
        window.revokeUser = function(userId) {
            if (confirm('ìŠ¹ì¸ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                database.ref(`users/${userId}`).update({
                    status: 'pending'
                });
            }
        };

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            sessionStorage.removeItem('adminLoggedIn');
            location.href = 'index.html';
        }

        // ì´ˆê¸° ë¡œë“œ
        loadUsers();
    </script>
</body>
</html>
